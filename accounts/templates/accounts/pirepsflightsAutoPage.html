{% extends 'base_main/baseDashboard.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
    <div class="card">
        <div class="card-corpo">
            <div class="titulo"><strong>Histórico de voos</strong> - Planos de voo que você gerou recentemente</div>
            <hr> <!-- Linha divisória -->
            <div class="caixa-conteudo">

                <!-- Dropdown para selecionar o voo -->
                <label for="flightSelection">Selecionar voo:</label>
                <select id="flightSelection" class="form-control">
                    {% for flight in last_flights %}
                        <option value="{{ flight.id }}">{{ flight.callsign }}</option>
                    {% endfor %}
                </select>

                <!-- Botão para carregar informações do voo -->
                <button id="loadFlightInfo" class="btn btn-primary">Carregar informações do voo</button>

                <!-- Formulário de registro de voo -->
                <form method="post">
                    {% csrf_token %}
                    {{ form.as_p }}  <!-- Exibe os campos do formulário -->

                    <button type="submit" class="btn btn-success">Registrar Voo</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ... (seu código HTML existente) ... -->

<!-- JSON data passado para JavaScript -->
<script id="lastFlightsData" type="application/json">
    {{ last_flights|json_script:"lastFlightsData" }}
</script>

<script>
document.getElementById('loadFlightInfo').addEventListener('click', function() {
  const selectedFlightId = document.getElementById('flightSelection').value;
  const flights = JSON.parse(document.getElementById('lastFlightsData').textContent);
  const selectedFlight = flights.find(flight => flight.id === selectedFlightId);

  if (selectedFlight) {
    document.getElementById('id_flight_number').value = selectedFlight.callsign || ''; // Valor padrão caso não exista
    // ... outros campos
  } else {
    console.error('Voo não encontrado:', selectedFlightId);
  }
});
</script>

<!-- ... (seu código HTML existente) ... -->

{% endblock %}
